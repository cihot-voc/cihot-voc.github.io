import{bi as S,r as v,bm as D,bf as M,bn as N,bo as P,b9 as e,bp as Q,bk as F,B as T,bl as q}from"../app.js";import{Q as z}from"./quill-editor-BzREhDcj.js";import{u as H,F as u}from"./index-DZjjEOTr.js";import{S as K}from"./index-Hu_4KWfa.js";import{C as O,s as I}from"./index-BUmyGOo3.js";import{j as R,I as $}from"./index-BE3p3K_8.js";import{F as U}from"./index-B68EXSTp.js";function te(){const[i]=H(),f=S(),a=v.useRef(null),{id:r}=D(),l=r!==void 0,m=l?"put":"post",{refetch:c}=M(),{data:o}=N(),d=v.useMemo(()=>Array.isArray(o)?o.map(({id:t,name:h})=>({label:h,value:t})):[],[o]),{data:n,isLoading:x,isError:C,error:p}=P(["blog",r],async()=>F.get(`/post/${r}`),{enabled:l});return C?e.jsx("pre",{children:p==null?void 0:p.error}):x?e.jsx(K,{}):e.jsxs("div",{className:V,children:[e.jsx(O,{title:`게시글 등록 ${m} ${x?"...":""}`,bordered:!0,children:e.jsxs(u,{initialValues:n,layout:"horizontal",form:i,onFinish:async t=>{var j,w;const h=t.content,g=document.createElement("div");g.innerHTML=h;const y=Array.from(g.querySelectorAll("img"));if(y.length)for(const s of y)if(typeof s.src=="string"){const b=G(s.src??"");if(b instanceof Blob){const L=((j=b.type.match(/^image\/([a-z\d]+)$/))==null?void 0:j[1])??"bin",B=new File([b],`screenshot.${L}`),A=await Q(B);console.debug(A);const k=A.id;s.src=`${k}`}else console.debug("skip blob",b)}else console.debug("skip src",(w=s.getAttribute("src"))==null?void 0:w.slice(0,32));const E={...t,content:g.innerHTML};F[m]("/post",E).then(s=>{console.debug(s),I.success("등록했습니다."),c(),f("..")}).catch(s=>I.error(JSON.stringify(s)))},children:[e.jsx(u.Item,{name:"categories",label:"카테고리",initialValue:[],children:Array.isArray(d)&&d.length>0?e.jsx(R.Group,{options:d}):"없음"}),e.jsx(u.Item,{name:"id",hidden:!0,children:e.jsx($,{})}),e.jsx(u.Item,{name:"title",label:"제목",rules:[{required:!0}],children:e.jsx($,{tabIndex:1,autoFocus:!0})}),e.jsx(u.Item,{name:"content",label:"내용",rules:[{required:!0}],children:e.jsx(z,{theme:"snow",tabIndex:1,onKeyDown:t=>{t.metaKey&&t.key==="Enter"&&(t.preventDefault(),i.submit())}})}),e.jsx(U,{justify:"flex-end",children:e.jsx(T,{htmlType:"submit",children:"게시"})})]})}),e.jsx("div",{ref:a,className:"preview"})]})}const V=q`
  margin: 2em;

  .preview {
    img {
      max-width: 100%;
      cursor: pointer;
    }
  }
`;function G(i,f=!1){var r;const a=i.split(",");if(a.length===2){const l=(r=a[0].match(/^data:([a-z/]+);base64$/))==null?void 0:r[1];if(l){const m=a[1],c=window.atob(m),o=new Uint8Array(c.length);for(let n=0;n<c.length;n++)o[n]=c.charCodeAt(n);return new Blob([o],{type:l})}}if(f)throw new Error(`base64 데이터 오류입니다. ${i.slice(0,30)} ...`);return null}export{te as default};
