import{e as L,u as B,r as E,f as S,b as k,g as M,h as P,j as e,S as Q,C as T,c as u,i as q,d as D,s as j,I as V,F as z,B as H}from"../web.js";import{Q as K}from"./quill-editor-Dx_IFHfC.js";import{c as O}from"./css-Dwe9CNOk.js";import{C as R}from"./index-BIS5sDnV.js";import"./index--sEWkCeX.js";function Z(){const[a]=L(),d=B(),l=E.useRef(null),{id:r}=S(),n=r!==void 0,m=n?"put":"post",{refetch:c}=k(),{data:o}=M(),b=E.useMemo(()=>Array.isArray(o)?o.map(({id:s,name:g})=>({label:g,value:s})):[],[o]),{data:i,isLoading:N,isError:A,error:p}=P(["blog",r],async()=>D.get(`/post/${r}`),{enabled:n});return A?e.jsxDEV("pre",{children:p==null?void 0:p.error},void 0,!1,{fileName:"/web/src/pages/blog/post/create.tsx",lineNumber:47,columnNumber:23},this):N?e.jsxDEV(Q,{},void 0,!1,{fileName:"/web/src/pages/blog/post/create.tsx",lineNumber:49,columnNumber:25},this):e.jsxDEV("div",{className:O,children:[e.jsxDEV(T,{title:`게시글 등록 ${m} ${N?"...":""}`,bordered:!0,children:e.jsxDEV(u,{initialValues:i,layout:"horizontal",form:a,onFinish:async s=>{var w,y;const g=s.content,h=document.createElement("div");h.innerHTML=g;const x=Array.from(h.querySelectorAll("img"));if(x.length)for(const t of x)if(typeof t.src=="string"){const f=U(t.src??"");if(f instanceof Blob){const C=((w=f.type.match(/^image\/([a-z\d]+)$/))==null?void 0:w[1])??"bin",F=new File([f],`screenshot.${C}`),v=await q(F);console.debug(v);const $=v.id;t.src=`${$}`}else console.debug("skip blob",f)}else console.debug("skip src",(y=t.getAttribute("src"))==null?void 0:y.slice(0,32));const I={...s,content:h.innerHTML};D[m]("/post",I).then(t=>{console.debug(t),j.success("등록했습니다."),c(),d("..")}).catch(t=>j.error(JSON.stringify(t)))},children:[e.jsxDEV(u.Item,{name:"categories",label:"카테고리",initialValue:[],children:Array.isArray(b)&&b.length>0?e.jsxDEV(R.Group,{options:b},void 0,!1,{fileName:"/web/src/pages/blog/post/create.tsx",lineNumber:100,columnNumber:15},this):"없음"},void 0,!1,{fileName:"/web/src/pages/blog/post/create.tsx",lineNumber:98,columnNumber:11},this),e.jsxDEV(u.Item,{name:"id",hidden:!0,children:e.jsxDEV(V,{},void 0,!1,{fileName:"/web/src/pages/blog/post/create.tsx",lineNumber:105,columnNumber:49},this)},void 0,!1,{fileName:"/web/src/pages/blog/post/create.tsx",lineNumber:105,columnNumber:11},this),e.jsxDEV(u.Item,{name:"title",label:"제목",rules:[{required:!0}],children:e.jsxDEV(V,{tabIndex:1,autoFocus:!0},void 0,!1,{fileName:"/web/src/pages/blog/post/create.tsx",lineNumber:107,columnNumber:13},this)},void 0,!1,{fileName:"/web/src/pages/blog/post/create.tsx",lineNumber:106,columnNumber:11},this),e.jsxDEV(u.Item,{name:"content",label:"내용",rules:[{required:!0}],children:e.jsxDEV(K,{theme:"snow",tabIndex:1,onKeyDown:s=>{s.metaKey&&s.key==="Enter"&&(s.preventDefault(),a.submit())}},void 0,!1,{fileName:"/web/src/pages/blog/post/create.tsx",lineNumber:110,columnNumber:13},this)},void 0,!1,{fileName:"/web/src/pages/blog/post/create.tsx",lineNumber:109,columnNumber:11},this),e.jsxDEV(z,{justify:"flex-end",children:e.jsxDEV(H,{htmlType:"submit",children:"게시"},void 0,!1,{fileName:"/web/src/pages/blog/post/create.tsx",lineNumber:122,columnNumber:13},this)},void 0,!1,{fileName:"/web/src/pages/blog/post/create.tsx",lineNumber:121,columnNumber:11},this)]},void 0,!0,{fileName:"/web/src/pages/blog/post/create.tsx",lineNumber:54,columnNumber:9},this)},void 0,!1,{fileName:"/web/src/pages/blog/post/create.tsx",lineNumber:53,columnNumber:7},this),e.jsxDEV("div",{ref:l,className:"preview"},void 0,!1,{fileName:"/web/src/pages/blog/post/create.tsx",lineNumber:126,columnNumber:7},this)]},void 0,!0,{fileName:"/web/src/pages/blog/post/create.tsx",lineNumber:52,columnNumber:5},this)}function U(a,d=!1){var r;const l=a.split(",");if(l.length===2){const n=(r=l[0].match(/^data:([a-z/]+);base64$/))==null?void 0:r[1];if(n){const m=l[1],c=window.atob(m),o=new Uint8Array(c.length);for(let i=0;i<c.length;i++)o[i]=c.charCodeAt(i);return new Blob([o],{type:n})}}if(d)throw new Error(`base64 데이터 오류입니다. ${a.slice(0,30)} ...`);return null}export{Z as default};
