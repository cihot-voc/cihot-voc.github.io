import{bA as k,bq as q,r as v,bB as z,bt as M,bC as N,bD as P,bu as e,bp as Q,bE as S,bw as u,bF as T,by as C,bG as E,bn as F,bv as G,B as H,bz as K}from"../app.js";import{Q as O}from"./quill-editor-Cx6mXDXX.js";import{C as R}from"./index-CDOisRdt.js";import"./index-DWP_LBIY.js";function Z(){const[i]=k(),f=q(),a=v.useRef(null),{id:r}=z(),c=r!==void 0,d=c?"put":"post",{refetch:l}=M(),{data:o}=N(),b=v.useMemo(()=>Array.isArray(o)?o.map(({id:t,name:p})=>({label:p,value:t})):[],[o]),{data:n,isLoading:x,isError:I,error:h}=P(["blog",r],async()=>C.get(`/post/${r}`),{enabled:c});return I?e.jsx("pre",{children:h==null?void 0:h.error}):x?e.jsx(Q,{}):e.jsxs("div",{className:U,children:[e.jsx(S,{title:`게시글 등록 ${d} ${x?"...":""}`,bordered:!0,children:e.jsxs(u,{initialValues:n,layout:"horizontal",form:i,onFinish:async t=>{var j,w;const p=t.content,g=document.createElement("div");g.innerHTML=p;const y=Array.from(g.querySelectorAll("img"));if(y.length)for(const s of y)if(typeof s.src=="string"){const m=V(s.src??"");if(m instanceof Blob){const B=((j=m.type.match(/^image\/([a-z\d]+)$/))==null?void 0:j[1])??"bin",L=new File([m],`screenshot.${B}`),A=await T(L);console.debug(A);const D=A.id;s.src=`${D}`}else console.debug("skip blob",m)}else console.debug("skip src",(w=s.getAttribute("src"))==null?void 0:w.slice(0,32));const $={...t,content:g.innerHTML};C[d]("/post",$).then(s=>{console.debug(s),E.success("등록했습니다."),l(),f("..")}).catch(s=>E.error(JSON.stringify(s)))},children:[e.jsx(u.Item,{name:"categories",label:"카테고리",initialValue:[],children:Array.isArray(b)&&b.length>0?e.jsx(R.Group,{options:b}):"없음"}),e.jsx(u.Item,{name:"id",hidden:!0,children:e.jsx(F,{})}),e.jsx(u.Item,{name:"title",label:"제목",rules:[{required:!0}],children:e.jsx(F,{tabIndex:1,autoFocus:!0})}),e.jsx(u.Item,{name:"content",label:"내용",rules:[{required:!0}],children:e.jsx(O,{theme:"snow",tabIndex:1,onKeyDown:t=>{t.metaKey&&t.key==="Enter"&&(t.preventDefault(),i.submit())}})}),e.jsx(G,{justify:"flex-end",children:e.jsx(H,{htmlType:"submit",children:"게시"})})]})}),e.jsx("div",{ref:a,className:"preview"})]})}const U=K`
  margin: 2em;

  .preview {
    img {
      max-width: 100%;
      cursor: pointer;
    }
  }
`;function V(i,f=!1){var r;const a=i.split(",");if(a.length===2){const c=(r=a[0].match(/^data:([a-z/]+);base64$/))==null?void 0:r[1];if(c){const d=a[1],l=window.atob(d),o=new Uint8Array(l.length);for(let n=0;n<l.length;n++)o[n]=l.charCodeAt(n);return new Blob([o],{type:c})}}if(f)throw new Error(`base64 데이터 오류입니다. ${i.slice(0,30)} ...`);return null}export{Z as default};
