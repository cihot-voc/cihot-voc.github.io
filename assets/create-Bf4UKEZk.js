import{bu as q,bq as z,r as A,bv as D,bl as M,bw as N,bx as P,bf as e,be as Q,bn as u,by as S,bs as F,bz as I,bc as $,B as T,bt as H}from"../app.js";import{Q as K}from"./quill-editor-Dzpk5qSp.js";import{C as O}from"./index-C7geTe0S.js";import{g as R}from"./index-CGTwVMhu.js";import{F as U}from"./index-0M8oz1V7.js";function _(){const[i]=q(),f=z(),a=A.useRef(null),{id:r}=D(),c=r!==void 0,d=c?"put":"post",{refetch:l}=M(),{data:o}=N(),b=A.useMemo(()=>Array.isArray(o)?o.map(({id:t,name:p})=>({label:p,value:t})):[],[o]),{data:n,isLoading:x,isError:C,error:h}=P(["blog",r],async()=>F.get(`/post/${r}`),{enabled:c});return C?e.jsx("pre",{children:h==null?void 0:h.error}):x?e.jsx(Q,{}):e.jsxs("div",{className:V,children:[e.jsx(O,{title:`게시글 등록 ${d} ${x?"...":""}`,bordered:!0,children:e.jsxs(u,{initialValues:n,layout:"horizontal",form:i,onFinish:async t=>{var j,w;const p=t.content,g=document.createElement("div");g.innerHTML=p;const y=Array.from(g.querySelectorAll("img"));if(y.length)for(const s of y)if(typeof s.src=="string"){const m=G(s.src??"");if(m instanceof Blob){const L=((j=m.type.match(/^image\/([a-z\d]+)$/))==null?void 0:j[1])??"bin",B=new File([m],`screenshot.${L}`),v=await S(B);console.debug(v);const k=v.id;s.src=`${k}`}else console.debug("skip blob",m)}else console.debug("skip src",(w=s.getAttribute("src"))==null?void 0:w.slice(0,32));const E={...t,content:g.innerHTML};F[d]("/post",E).then(s=>{console.debug(s),I.success("등록했습니다."),l(),f("..")}).catch(s=>I.error(JSON.stringify(s)))},children:[e.jsx(u.Item,{name:"categories",label:"카테고리",initialValue:[],children:Array.isArray(b)&&b.length>0?e.jsx(R.Group,{options:b}):"없음"}),e.jsx(u.Item,{name:"id",hidden:!0,children:e.jsx($,{})}),e.jsx(u.Item,{name:"title",label:"제목",rules:[{required:!0}],children:e.jsx($,{tabIndex:1,autoFocus:!0})}),e.jsx(u.Item,{name:"content",label:"내용",rules:[{required:!0}],children:e.jsx(K,{theme:"snow",tabIndex:1,onKeyDown:t=>{t.metaKey&&t.key==="Enter"&&(t.preventDefault(),i.submit())}})}),e.jsx(U,{justify:"flex-end",children:e.jsx(T,{htmlType:"submit",children:"게시"})})]})}),e.jsx("div",{ref:a,className:"preview"})]})}const V=H`
  margin: 2em;

  .preview {
    img {
      max-width: 100%;
      cursor: pointer;
    }
  }
`;function G(i,f=!1){var r;const a=i.split(",");if(a.length===2){const c=(r=a[0].match(/^data:([a-z/]+);base64$/))==null?void 0:r[1];if(c){const d=a[1],l=window.atob(d),o=new Uint8Array(l.length);for(let n=0;n<l.length;n++)o[n]=l.charCodeAt(n);return new Blob([o],{type:c})}}if(f)throw new Error(`base64 데이터 오류입니다. ${i.slice(0,30)} ...`);return null}export{_ as default};
