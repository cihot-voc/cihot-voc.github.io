import{r as l,t as N,C as A,ar as k,as as R,c as _,I as P,_ as B,j as o,w as z,i as U,A as j,l as M,n as y,s as D,F}from"../web.js";import{u as L}from"./use-yup-params-8nHEo682.js";import{g as $}from"./dropdown-BySDfBJe.js";import{S as O,D as V}from"./index-ejgHpRPS.js";import{S as E}from"./index-C-CKWqDQ.js";import{A as w}from"./index-BkK6py1q.js";import{c as q}from"./index.esm-CnD8eApZ.js";import"./DownOutlined-Bre27_U7.js";import"./index-CYjZiiai.js";const{Option:p}=O;function I(t){return(t==null?void 0:t.type)&&(t.type.isSelectOption||t.type.isSelectOptGroup)}const G=(t,e)=>{var s;const{prefixCls:g,className:m,popupClassName:C,dropdownClassName:h,children:x,dataSource:u}=t,i=N(x);let f;i.length===1&&l.isValidElement(i[0])&&!I(i[0])&&([f]=i);const S=f?()=>f:void 0;let n;i.length&&I(i[0])?n=x:n=u?u.map(r=>{if(l.isValidElement(r))return r;switch(typeof r){case"string":return l.createElement(p,{key:r,value:r},r);case"object":{const{value:v}=r;return l.createElement(p,{key:v,value:v},r.text)}default:return}}):[];const{getPrefixCls:c}=l.useContext(A),a=c("select",g),[d]=k("SelectLike",(s=t.dropdownStyle)===null||s===void 0?void 0:s.zIndex);return l.createElement(O,Object.assign({ref:e,suffixIcon:null},R(t,["dataSource","dropdownClassName"]),{prefixCls:a,popupClassName:C||h,dropdownStyle:Object.assign(Object.assign({},t.dropdownStyle),{zIndex:d}),className:_(`${a}-auto-complete`,m),mode:O.SECRET_COMBOBOX_MODE_DO_NOT_USE,getInputElement:S}),n)},b=l.forwardRef(G),H=$(b);b.Option=p;b._InternalPanelDoNotUseOrYouWillBeFired=H;var T={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M858.5 763.6a374 374 0 00-80.6-119.5 375.63 375.63 0 00-119.5-80.6c-.4-.2-.8-.3-1.2-.5C719.5 518 760 444.7 760 362c0-137-111-248-248-248S264 225 264 362c0 82.7 40.5 156 102.8 201.1-.4.2-.8.3-1.2.5-44.8 18.9-85 46-119.5 80.6a375.63 375.63 0 00-80.6 119.5A371.7 371.7 0 00136 901.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8 2-77.2 33-149.5 87.8-204.3 56.7-56.7 132-87.9 212.2-87.9s155.5 31.2 212.2 87.9C779 752.7 810 825 812 902.2c.1 4.4 3.6 7.8 8 7.8h60a8 8 0 008-8.2c-1-47.8-10.9-94.3-29.5-138.2zM512 534c-45.9 0-89.1-17.9-121.6-50.4S340 407.9 340 362c0-45.9 17.9-89.1 50.4-121.6S466.1 190 512 190s89.1 17.9 121.6 50.4S684 316.1 684 362c0 45.9-17.9 89.1-50.4 121.6S557.9 534 512 534z"}}]},name:"user",theme:"outlined"},W=function(e,s){return l.createElement(P,B({},e,{ref:s,icon:T}))},Y=l.forwardRef(W);const Q=t=>j.users.getByEmail(t).then(e=>e.map(s=>({value:s.email,label:o.jsxs(E,{children:[o.jsx(w,{src:s.avatar}),o.jsxs("span",{children:[s.name," (",s.email,")"]})]}),user:s}))).catch(()=>[]);function X(t){var f,S;const[e,s]=l.useState((t==null?void 0:t.value)??null),g=l.useRef(null),[m,C]=l.useState([]),h=n=>{n=n.trim(),n.length>=3&&n!==(e==null?void 0:e.email)?Q(n).then(C):C([])},x=(n,c)=>{var d;const a=(d=g.current)==null?void 0:d.querySelector(".ant-input-clear-icon");a&&a.click(),s(c.user)},u=()=>{var c,a;const n=(c=t.roles)==null?void 0:c.at(0);e&&n&&(e.role=n,(a=t.onChange)==null||a.call(t,e),console.log("invite",e))},i=({key:n})=>{var a,d,r;const c=(d=(a=t.roles)==null?void 0:a.find)==null?void 0:d.call(a,v=>v.roleId===Number(n));e&&c&&(e.role=c,(r=t.onChange)==null||r.call(t,e),console.log("invite",e))};return o.jsxs(z,{title:"사용자 검색",styles:{title:{textAlign:"center"},body:{textAlign:"center"}},ref:g,style:{maxWidth:480},children:[o.jsx(b,{options:m,onSelect:x,autoFocus:!0,children:o.jsx(U.Search,{placeholder:"이메일을 입력해주세요.",allowClear:!0,enterButton:!0,onSearch:h})}),e?o.jsxs(E,{style:{marginInline:"auto",minHeight:"8em"},children:[o.jsx(w,{size:"large",src:e.avatar,icon:o.jsx(Y,{})}),o.jsxs("span",{children:[e.name," (",e.email,")"]}),o.jsxs(V.Button,{menu:{items:t.roles.slice(1).map(n=>({key:n.roleId,label:`${n.name}로 초대하기`,onClick:()=>{console.log("invite",e,n)}})),onClick:i},onClick:u,children:[(S=(f=t.roles)==null?void 0:f.at(0))==null?void 0:S.name,"로 초대하기"]})]}):o.jsx("div",{style:{minHeight:"8em"}})]})}function le(){const t=M(),{projectId:e}=L({projectId:q().required()}),{data:s=[],isSuccess:g}=y(["users",e],j.collaborators.getList.bind(null,e),{enabled:e>0}),{data:m=[],isSuccess:C}=y(["roles",e],j.roles.getList.bind(null,e),{enabled:e>0}),{mutateAsync:h,isLoading:x}=D(j.collaborators.invite,{onSuccess:()=>{t(`/projects/${e}/collaborators`)}});return F.useForm(),console.debug(s,m),o.jsx("div",{children:o.jsx(X,{roles:m,onChange:u=>{h({projectId:e,userId:u.userId,roleId:u.role.roleId})}})})}export{le as default};
