import{bJ as N,bF as P,r as v,bK as k,bA as D,bL as Q,bM as S,bu as e,bt as T,bN as q,bC as u,bO as z,bH as F,bP as I,br as L,B as H,bI as K}from"../app.js";import{Q as O}from"./quill-editor-DU-DPZdz.js";import{a as J}from"./index-BruadH_M.js";import{F as R}from"./index-iqTqLuZh.js";function Z(){const[a]=N(),f=P(),i=v.useRef(null),{id:r}=k(),c=r!==void 0,d=c?"put":"post",{refetch:l}=D(),{data:o}=Q(),b=v.useMemo(()=>Array.isArray(o)?o.map(({id:t,name:p})=>({label:p,value:t})):[],[o]),{data:n,isLoading:x,isError:$,error:h}=S(["blog",r],async()=>F.get(`/post/${r}`),{enabled:c});return $?e.jsx("pre",{children:h==null?void 0:h.error}):x?e.jsx(T,{}):e.jsxs("div",{className:U,children:[e.jsx(q,{title:`게시글 등록 ${d} ${x?"...":""}`,bordered:!0,children:e.jsxs(u,{initialValues:n,layout:"horizontal",form:a,onFinish:async t=>{var j,w;const p=t.content,g=document.createElement("div");g.innerHTML=p;const y=Array.from(g.querySelectorAll("img"));if(y.length)for(const s of y)if(typeof s.src=="string"){const m=V(s.src??"");if(m instanceof Blob){const E=((j=m.type.match(/^image\/([a-z\d]+)$/))==null?void 0:j[1])??"bin",B=new File([m],`screenshot.${E}`),A=await z(B);console.debug(A);const M=A.id;s.src=`${M}`}else console.debug("skip blob",m)}else console.debug("skip src",(w=s.getAttribute("src"))==null?void 0:w.slice(0,32));const C={...t,content:g.innerHTML};F[d]("/post",C).then(s=>{console.debug(s),I.success("등록했습니다."),l(),f("..")}).catch(s=>I.error(JSON.stringify(s)))},children:[e.jsx(u.Item,{name:"categories",label:"카테고리",initialValue:[],children:Array.isArray(b)&&b.length>0?e.jsx(J.Group,{options:b}):"없음"}),e.jsx(u.Item,{name:"id",hidden:!0,children:e.jsx(L,{})}),e.jsx(u.Item,{name:"title",label:"제목",rules:[{required:!0}],children:e.jsx(L,{tabIndex:1,autoFocus:!0})}),e.jsx(u.Item,{name:"content",label:"내용",rules:[{required:!0}],children:e.jsx(O,{theme:"snow",tabIndex:1,onKeyDown:t=>{t.metaKey&&t.key==="Enter"&&(t.preventDefault(),a.submit())}})}),e.jsx(R,{justify:"flex-end",children:e.jsx(H,{htmlType:"submit",children:"게시"})})]})}),e.jsx("div",{ref:i,className:"preview"})]})}const U=K`
  margin: 2em;

  .preview {
    img {
      max-width: 100%;
      cursor: pointer;
    }
  }
`;function V(a,f=!1){var r;const i=a.split(",");if(i.length===2){const c=(r=i[0].match(/^data:([a-z/]+);base64$/))==null?void 0:r[1];if(c){const d=i[1],l=window.atob(d),o=new Uint8Array(l.length);for(let n=0;n<l.length;n++)o[n]=l.charCodeAt(n);return new Blob([o],{type:c})}}if(f)throw new Error(`base64 데이터 오류입니다. ${a.slice(0,30)} ...`);return null}export{Z as default};
