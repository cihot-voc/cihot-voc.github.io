import{ax as z,l as D,r as v,v as M,av as N,ay as P,n as Q,j as e,az as S,w as T,F as u,aA as q,aw as F,aB as I,i as $,H,B as K}from"../web.js";import{Q as O}from"./quill-editor-IseXW9Ia.js";import{c as R}from"./css-BRyxPvm2.js";import{C as U}from"./index-Cq2plmkM.js";import"./useBubbleLock-Kz7pQh5h.js";function Z(){const[a]=z(),h=D(),i=v.useRef(null),{id:r}=M(),l=r!==void 0,d=l?"put":"post",{refetch:c}=N(),{data:o}=P(),m=v.useMemo(()=>Array.isArray(o)?o.map(({id:t,name:p})=>({label:p,value:t})):[],[o]),{data:n,isLoading:y,isError:B,error:b}=Q(["blog",r],async()=>F.get(`/post/${r}`),{enabled:l});return B?e.jsx("pre",{children:b==null?void 0:b.error}):y?e.jsx(S,{}):e.jsxs("div",{className:R,children:[e.jsx(T,{title:`게시글 등록 ${d} ${y?"...":""}`,bordered:!0,children:e.jsxs(u,{initialValues:n,layout:"horizontal",form:a,onFinish:async t=>{var j,w;const p=t.content,x=document.createElement("div");x.innerHTML=p;const g=Array.from(x.querySelectorAll("img"));if(g.length)for(const s of g)if(typeof s.src=="string"){const f=V(s.src??"");if(f instanceof Blob){const E=((j=f.type.match(/^image\/([a-z\d]+)$/))==null?void 0:j[1])??"bin",L=new File([f],`screenshot.${E}`),A=await q(L);console.debug(A);const k=A.id;s.src=`${k}`}else console.debug("skip blob",f)}else console.debug("skip src",(w=s.getAttribute("src"))==null?void 0:w.slice(0,32));const C={...t,content:x.innerHTML};F[d]("/post",C).then(s=>{console.debug(s),I.success("등록했습니다."),c(),h("..")}).catch(s=>I.error(JSON.stringify(s)))},children:[e.jsx(u.Item,{name:"categories",label:"카테고리",initialValue:[],children:Array.isArray(m)&&m.length>0?e.jsx(U.Group,{options:m}):"없음"}),e.jsx(u.Item,{name:"id",hidden:!0,children:e.jsx($,{})}),e.jsx(u.Item,{name:"title",label:"제목",rules:[{required:!0}],children:e.jsx($,{tabIndex:1,autoFocus:!0})}),e.jsx(u.Item,{name:"content",label:"내용",rules:[{required:!0}],children:e.jsx(O,{theme:"snow",tabIndex:1,onKeyDown:t=>{t.metaKey&&t.key==="Enter"&&(t.preventDefault(),a.submit())}})}),e.jsx(H,{justify:"flex-end",children:e.jsx(K,{htmlType:"submit",children:"게시"})})]})}),e.jsx("div",{ref:i,className:"preview"})]})}function V(a,h=!1){var r;const i=a.split(",");if(i.length===2){const l=(r=i[0].match(/^data:([a-z/]+);base64$/))==null?void 0:r[1];if(l){const d=i[1],c=window.atob(d),o=new Uint8Array(c.length);for(let n=0;n<c.length;n++)o[n]=c.charCodeAt(n);return new Blob([o],{type:l})}}if(h)throw new Error(`base64 데이터 오류입니다. ${a.slice(0,30)} ...`);return null}export{Z as default};
