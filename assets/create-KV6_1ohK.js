import{r as n,t as K,C as D,aH as ue,b0 as me,c as A,g as ge,m as fe,a as ve,u as pe,a4 as Se,am as he,b7 as Ce,bF as xe,aj as ee,bg as be,d as ye,I as Oe,_ as je,j as C,n as ze,i as Ee,A as _,D as Ie,q as Q,G as Pe,F as $e}from"../web.js";import{u as Ne,c as Re}from"./use-yup-params-p5E1rgJi.js";import{g as we}from"./dropdown-QIiZhNxb.js";import{S as V,D as ke}from"./index-AROoAIfj.js";import{S as te}from"./index-d5N8vm3K.js";import{P as Ae}from"./index-XZoU7LEC.js";import"./DownOutlined-BOejTe-8.js";const{Option:W}=V;function Z(e){return(e==null?void 0:e.type)&&(e.type.isSelectOption||e.type.isSelectOptGroup)}const Be=(e,t)=>{var o;const{prefixCls:s,className:l,popupClassName:x,dropdownClassName:p,children:S,dataSource:u}=e,c=K(S);let h;c.length===1&&n.isValidElement(c[0])&&!Z(c[0])&&([h]=c);const j=h?()=>h:void 0;let r;c.length&&Z(c[0])?r=S:r=u?u.map(m=>{if(n.isValidElement(m))return m;switch(typeof m){case"string":return n.createElement(W,{key:m,value:m},m);case"object":{const{value:a}=m;return n.createElement(W,{key:a,value:a},m.text)}default:return}}):[];const{getPrefixCls:i}=n.useContext(D),d=i("select",s),[b]=ue("SelectLike",(o=e.dropdownStyle)===null||o===void 0?void 0:o.zIndex);return n.createElement(V,Object.assign({ref:t,suffixIcon:null},me(e,["dataSource","dropdownClassName"]),{prefixCls:d,popupClassName:x||p,dropdownStyle:Object.assign(Object.assign({},e.dropdownStyle),{zIndex:b}),className:A(`${d}-auto-complete`,l),mode:V.SECRET_COMBOBOX_MODE_DO_NOT_USE,getInputElement:j}),r)},F=n.forwardRef(Be),Me=we(F);F.Option=W;F._InternalPanelDoNotUseOrYouWillBeFired=Me;const U=n.createContext({}),_e=e=>{const{antCls:t,componentCls:o,iconCls:s,avatarBg:l,avatarColor:x,containerSize:p,containerSizeLG:S,containerSizeSM:u,textFontSize:c,textFontSizeLG:h,textFontSizeSM:j,borderRadius:r,borderRadiusLG:i,borderRadiusSM:d,lineWidth:b,lineType:m}=e,a=(z,O,N)=>({width:z,height:z,borderRadius:"50%",[`&${o}-square`]:{borderRadius:N},[`&${o}-icon`]:{fontSize:O,[`> ${s}`]:{margin:0}}});return{[o]:Object.assign(Object.assign(Object.assign(Object.assign({},ve(e)),{position:"relative",display:"inline-flex",justifyContent:"center",alignItems:"center",overflow:"hidden",color:x,whiteSpace:"nowrap",textAlign:"center",verticalAlign:"middle",background:l,border:`${pe(b)} ${m} transparent`,"&-image":{background:"transparent"},[`${t}-image-img`]:{display:"block"}}),a(p,c,r)),{"&-lg":Object.assign({},a(S,h,i)),"&-sm":Object.assign({},a(u,j,d)),"> img":{display:"block",width:"100%",height:"100%",objectFit:"cover"}})}},Fe=e=>{const{componentCls:t,groupBorderColor:o,groupOverlapping:s,groupSpace:l}=e;return{[`${t}-group`]:{display:"inline-flex",[t]:{borderColor:o},"> *:not(:first-child)":{marginInlineStart:s}},[`${t}-group-popover`]:{[`${t} + ${t}`]:{marginInlineStart:l}}}},Le=e=>{const{controlHeight:t,controlHeightLG:o,controlHeightSM:s,fontSize:l,fontSizeLG:x,fontSizeXL:p,fontSizeHeading3:S,marginXS:u,marginXXS:c,colorBorderBg:h}=e;return{containerSize:t,containerSizeLG:o,containerSizeSM:s,textFontSize:Math.round((x+p)/2),textFontSizeLG:S,textFontSizeSM:l,groupSpace:c,groupOverlapping:-u,groupBorderColor:h}},ne=ge("Avatar",e=>{const{colorTextLightSolid:t,colorTextPlaceholder:o}=e,s=fe(e,{avatarBg:o,avatarColor:t});return[_e(s),Fe(s)]},Le);var Ge=function(e,t){var o={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(o[s]=e[s]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,s=Object.getOwnPropertySymbols(e);l<s.length;l++)t.indexOf(s[l])<0&&Object.prototype.propertyIsEnumerable.call(e,s[l])&&(o[s[l]]=e[s[l]]);return o};const Te=(e,t)=>{const[o,s]=n.useState(1),[l,x]=n.useState(!1),[p,S]=n.useState(!0),u=n.useRef(null),c=n.useRef(null),h=Se(t,u),{getPrefixCls:j,avatar:r}=n.useContext(D),i=n.useContext(U),d=()=>{if(!c.current||!u.current)return;const g=c.current.offsetWidth,f=u.current.offsetWidth;if(g!==0&&f!==0){const{gap:P=4}=e;P*2<f&&s(f-P*2<g?(f-P*2)/g:1)}};n.useEffect(()=>{x(!0)},[]),n.useEffect(()=>{S(!0),s(1)},[e.src]),n.useEffect(d,[e.gap]);const b=()=>{const{onError:g}=e;(g==null?void 0:g())!==!1&&S(!1)},{prefixCls:m,shape:a,size:z,src:O,srcSet:N,icon:$,className:L,rootClassName:G,alt:B,draggable:R,children:E,crossOrigin:k}=e,I=Ge(e,["prefixCls","shape","size","src","srcSet","icon","className","rootClassName","alt","draggable","children","crossOrigin"]),v=he(g=>{var f,P;return(P=(f=z??(i==null?void 0:i.size))!==null&&f!==void 0?f:g)!==null&&P!==void 0?P:"default"}),T=Object.keys(typeof v=="object"?v||{}:{}).some(g=>["xs","sm","md","lg","xl","xxl"].includes(g)),M=Ce(T),H=n.useMemo(()=>{if(typeof v!="object")return{};const g=xe.find(P=>M[P]),f=v[g];return f?{width:f,height:f,fontSize:f&&($||E)?f/2:18}:{}},[M,v]),y=j("avatar",m),q=ee(y),[se,re,ae]=ne(y,q),le=A({[`${y}-lg`]:v==="large",[`${y}-sm`]:v==="small"}),Y=n.isValidElement(O),ie=a||(i==null?void 0:i.shape)||"circle",ce=A(y,le,r==null?void 0:r.className,`${y}-${ie}`,{[`${y}-image`]:Y||O&&p,[`${y}-icon`]:!!$},ae,q,L,G,re),de=typeof v=="number"?{width:v,height:v,fontSize:$?v/2:18}:{};let w;if(typeof O=="string"&&p)w=n.createElement("img",{src:O,draggable:R,srcSet:N,onError:b,alt:B,crossOrigin:k});else if(Y)w=O;else if($)w=$;else if(l||o!==1){const g=`scale(${o})`,f={msTransform:g,WebkitTransform:g,transform:g};w=n.createElement(be,{onResize:d},n.createElement("span",{className:`${y}-string`,ref:c,style:Object.assign({},f)},E))}else w=n.createElement("span",{className:`${y}-string`,style:{opacity:0},ref:c},E);return delete I.onError,delete I.gap,se(n.createElement("span",Object.assign({},I,{style:Object.assign(Object.assign(Object.assign(Object.assign({},de),H),r==null?void 0:r.style),I.style),className:ce,ref:h}),w))},oe=n.forwardRef(Te),J=e=>{const{size:t,shape:o}=n.useContext(U),s=n.useMemo(()=>({size:e.size||t,shape:e.shape||o}),[e.size,e.shape,t,o]);return n.createElement(U.Provider,{value:s},e.children)},He=e=>{var t,o,s;const{getPrefixCls:l,direction:x}=n.useContext(D),{prefixCls:p,className:S,rootClassName:u,style:c,maxCount:h,maxStyle:j,size:r,shape:i,maxPopoverPlacement:d,maxPopoverTrigger:b,children:m,max:a}=e,z=l("avatar",p),O=`${z}-group`,N=ee(z),[$,L,G]=ne(z,N),B=A(O,{[`${O}-rtl`]:x==="rtl"},G,N,S,u,L),R=K(m).map((I,v)=>ye(I,{key:`avatar-key-${v}`})),E=(a==null?void 0:a.count)||h,k=R.length;if(E&&E<k){const I=R.slice(0,E),v=R.slice(E,k),T=(a==null?void 0:a.style)||j,M=((t=a==null?void 0:a.popover)===null||t===void 0?void 0:t.trigger)||b||"hover",H=((o=a==null?void 0:a.popover)===null||o===void 0?void 0:o.placement)||d||"top",y=Object.assign(Object.assign({content:v},a==null?void 0:a.popover),{overlayClassName:A(`${O}-popover`,(s=a==null?void 0:a.popover)===null||s===void 0?void 0:s.overlayClassName),placement:H,trigger:M});return I.push(n.createElement(Ae,Object.assign({key:"avatar-popover-key",destroyTooltipOnHide:!0},y),n.createElement(oe,{style:T},`+${k-E}`))),$(n.createElement(J,{shape:i,size:r},n.createElement("div",{className:B,style:c},I)))}return $(n.createElement(J,{shape:i,size:r},n.createElement("div",{className:B,style:c},R)))},X=oe;X.Group=He;var Ve={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M858.5 763.6a374 374 0 00-80.6-119.5 375.63 375.63 0 00-119.5-80.6c-.4-.2-.8-.3-1.2-.5C719.5 518 760 444.7 760 362c0-137-111-248-248-248S264 225 264 362c0 82.7 40.5 156 102.8 201.1-.4.2-.8.3-1.2.5-44.8 18.9-85 46-119.5 80.6a375.63 375.63 0 00-80.6 119.5A371.7 371.7 0 00136 901.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8 2-77.2 33-149.5 87.8-204.3 56.7-56.7 132-87.9 212.2-87.9s155.5 31.2 212.2 87.9C779 752.7 810 825 812 902.2c.1 4.4 3.6 7.8 8 7.8h60a8 8 0 008-8.2c-1-47.8-10.9-94.3-29.5-138.2zM512 534c-45.9 0-89.1-17.9-121.6-50.4S340 407.9 340 362c0-45.9 17.9-89.1 50.4-121.6S466.1 190 512 190s89.1 17.9 121.6 50.4S684 316.1 684 362c0 45.9-17.9 89.1-50.4 121.6S557.9 534 512 534z"}}]},name:"user",theme:"outlined"},We=function(t,o){return n.createElement(Oe,je({},t,{ref:o,icon:Ve}))},Ue=n.forwardRef(We);const De=e=>_.users.getByEmail(e).then(t=>t.map(o=>({value:o.email,label:C.jsxs(te,{children:[C.jsx(X,{src:o.avatar}),C.jsxs("span",{children:[o.name," (",o.email,")"]})]}),user:o}))).catch(()=>[]);function Xe(e){var h,j;const[t,o]=n.useState((e==null?void 0:e.value)??null),s=n.useRef(null),[l,x]=n.useState([]),p=r=>{r=r.trim(),r.length>=3&&r!==(t==null?void 0:t.email)?De(r).then(x):x([])},S=(r,i)=>{var b;const d=(b=s.current)==null?void 0:b.querySelector(".ant-input-clear-icon");d&&d.click(),o(i.user)},u=()=>{var i,d;const r=(i=e.roles)==null?void 0:i.at(0);t&&r&&(t.role=r,(d=e.onChange)==null||d.call(e,t),console.log("invite",t))},c=({key:r})=>{var d,b,m;const i=(b=(d=e.roles)==null?void 0:d.find)==null?void 0:b.call(d,a=>a.roleId===Number(r));t&&i&&(t.role=i,(m=e.onChange)==null||m.call(e,t),console.log("invite",t))};return C.jsxs(ze,{title:"사용자 검색",styles:{title:{textAlign:"center"},body:{textAlign:"center"}},ref:s,style:{maxWidth:480},children:[C.jsx(F,{options:l,onSelect:S,autoFocus:!0,children:C.jsx(Ee.Search,{placeholder:"이메일을 입력해주세요.",allowClear:!0,enterButton:!0,onSearch:p})}),t?C.jsxs(te,{style:{marginInline:"auto",minHeight:"8em"},children:[C.jsx(X,{size:"large",src:t.avatar,icon:C.jsx(Ue,{})}),C.jsxs("span",{children:[t.name," (",t.email,")"]}),C.jsxs(ke.Button,{menu:{items:e.roles.slice(1).map(r=>({key:r.roleId,label:`${r.name}로 초대하기`,onClick:()=>{console.log("invite",t,r)}})),onClick:c},onClick:u,children:[(j=(h=e.roles)==null?void 0:h.at(0))==null?void 0:j.name,"로 초대하기"]})]}):C.jsx("div",{style:{minHeight:"8em"}})]})}function tt(){const e=Ie(),{projectId:t}=Ne({projectId:Re().required()}),{data:o=[],isSuccess:s}=Q(["users",t],_.collaborators.getList.bind(null,t),{enabled:t>0}),{data:l=[],isSuccess:x}=Q(["roles",t],_.roles.getList.bind(null,t),{enabled:t>0}),{mutateAsync:p,isLoading:S}=Pe(_.collaborators.invite,{onSuccess:()=>{e(`/projects/${t}/collaborators`)}});return $e.useForm(),console.debug(o,l),C.jsx("div",{children:C.jsx(Xe,{roles:l,onChange:u=>{p({projectId:t,userId:u.userId,roleId:u.role.roleId})}})})}export{tt as default};
